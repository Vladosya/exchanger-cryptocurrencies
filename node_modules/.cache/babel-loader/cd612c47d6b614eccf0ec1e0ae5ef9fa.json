{"ast":null,"code":"import _regeneratorRuntime from \"C:/Job/work/365-change/frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";\nimport _asyncToGenerator from \"C:/Job/work/365-change/frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport axios from \"axios\";\nexport var API_URL = \"http://localhost:5000/api-v1\";\nvar $api = axios.create({\n  withCredentials: true,\n  baseURL: API_URL\n});\n$api.interceptors.request.use(function (config) {\n  var _config$headers;\n\n  ((_config$headers = config.headers) !== null && _config$headers !== void 0 ? _config$headers : config.headers = {}).Authorization = \"Bearer \".concat(localStorage.getItem(\"token\"));\n  return config;\n});\n$api.interceptors.response.use(function (config) {\n  console.log(\"config\", config);\n  return config;\n}, /*#__PURE__*/function () {\n  var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime().mark(function _callee(error) {\n    var originalRequest, response;\n    return _regeneratorRuntime().wrap(function _callee$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            console.log(\"error\", error);\n            originalRequest = error.config;\n\n            if (!(error.response.status === 401 && error.config && !error.config._isRetry)) {\n              _context.next = 15;\n              break;\n            }\n\n            originalRequest._isRetry = true;\n            _context.prev = 4;\n            _context.next = 7;\n            return axios.get(\"\".concat(API_URL, \"/refresh\"), {\n              withCredentials: true\n            });\n\n          case 7:\n            response = _context.sent;\n            localStorage.setItem(\"token\", response.data.result.accessToken);\n            return _context.abrupt(\"return\", $api.request(originalRequest));\n\n          case 12:\n            _context.prev = 12;\n            _context.t0 = _context[\"catch\"](4);\n            console.log(\"Не авторизован. error in interceptors.response error callback -->\", _context.t0);\n\n          case 15:\n            return _context.abrupt(\"return\", error.response.data);\n\n          case 16:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, _callee, null, [[4, 12]]);\n  }));\n\n  return function (_x) {\n    return _ref.apply(this, arguments);\n  };\n}());\nexport default $api;","map":{"version":3,"names":["axios","API_URL","$api","create","withCredentials","baseURL","interceptors","request","use","config","headers","Authorization","localStorage","getItem","response","console","log","error","originalRequest","status","_isRetry","get","setItem","data","result","accessToken"],"sources":["C:/Job/work/365-change/frontend/src/http/index.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\nexport const API_URL = \"http://localhost:5000/api-v1\";\r\n\r\nconst $api = axios.create({\r\n  withCredentials: true,\r\n  baseURL: API_URL,\r\n});\r\n\r\n$api.interceptors.request.use((config) => {\r\n  (config.headers ??= {}).Authorization = `Bearer ${localStorage.getItem(\"token\")}`;\r\n\r\n  return config;\r\n});\r\n\r\n$api.interceptors.response.use(\r\n  (config) => {\r\n    console.log(\"config\", config);\r\n    return config;\r\n  },\r\n  async (error) => {\r\n    console.log(\"error\", error);\r\n    const originalRequest = error.config;\r\n    if (error.response.status === 401 && error.config && !error.config._isRetry) {\r\n      originalRequest._isRetry = true;\r\n      try {\r\n        const response = await axios.get(`${API_URL}/refresh`, {\r\n          withCredentials: true,\r\n        });\r\n        localStorage.setItem(\"token\", response.data.result.accessToken);\r\n        return $api.request(originalRequest);\r\n      } catch (error) {\r\n        console.log(\"Не авторизован. error in interceptors.response error callback -->\", error);\r\n      }\r\n    }\r\n    return error.response.data;\r\n  },\r\n);\r\n\r\nexport default $api;\r\n"],"mappings":";;AAAA,OAAOA,KAAP,MAAkB,OAAlB;AAEA,OAAO,IAAMC,OAAO,GAAG,8BAAhB;AAEP,IAAMC,IAAI,GAAGF,KAAK,CAACG,MAAN,CAAa;EACxBC,eAAe,EAAE,IADO;EAExBC,OAAO,EAAEJ;AAFe,CAAb,CAAb;AAKAC,IAAI,CAACI,YAAL,CAAkBC,OAAlB,CAA0BC,GAA1B,CAA8B,UAACC,MAAD,EAAY;EAAA;;EACxC,oBAACA,MAAM,CAACC,OAAR,6DAACD,MAAM,CAACC,OAAR,GAAoB,EAApB,EAAwBC,aAAxB,oBAAkDC,YAAY,CAACC,OAAb,CAAqB,OAArB,CAAlD;EAEA,OAAOJ,MAAP;AACD,CAJD;AAMAP,IAAI,CAACI,YAAL,CAAkBQ,QAAlB,CAA2BN,GAA3B,CACE,UAACC,MAAD,EAAY;EACVM,OAAO,CAACC,GAAR,CAAY,QAAZ,EAAsBP,MAAtB;EACA,OAAOA,MAAP;AACD,CAJH;EAAA,sEAKE,iBAAOQ,KAAP;IAAA;IAAA;MAAA;QAAA;UAAA;YACEF,OAAO,CAACC,GAAR,CAAY,OAAZ,EAAqBC,KAArB;YACMC,eAFR,GAE0BD,KAAK,CAACR,MAFhC;;YAAA,MAGMQ,KAAK,CAACH,QAAN,CAAeK,MAAf,KAA0B,GAA1B,IAAiCF,KAAK,CAACR,MAAvC,IAAiD,CAACQ,KAAK,CAACR,MAAN,CAAaW,QAHrE;cAAA;cAAA;YAAA;;YAIIF,eAAe,CAACE,QAAhB,GAA2B,IAA3B;YAJJ;YAAA;YAAA,OAM6BpB,KAAK,CAACqB,GAAN,WAAapB,OAAb,eAAgC;cACrDG,eAAe,EAAE;YADoC,CAAhC,CAN7B;;UAAA;YAMYU,QANZ;YASMF,YAAY,CAACU,OAAb,CAAqB,OAArB,EAA8BR,QAAQ,CAACS,IAAT,CAAcC,MAAd,CAAqBC,WAAnD;YATN,iCAUavB,IAAI,CAACK,OAAL,CAAaW,eAAb,CAVb;;UAAA;YAAA;YAAA;YAYMH,OAAO,CAACC,GAAR,CAAY,mEAAZ;;UAZN;YAAA,iCAeSC,KAAK,CAACH,QAAN,CAAeS,IAfxB;;UAAA;UAAA;YAAA;QAAA;MAAA;IAAA;EAAA,CALF;;EAAA;IAAA;EAAA;AAAA;AAwBA,eAAerB,IAAf"},"metadata":{},"sourceType":"module"}